## Домашнее задание 1. Отчет по MongoDB

<font color="green"><h4>Ахмаджонов Мумтозбек</h4></font>

- <h3>Шаг первый</h3>

Установим MongoDB Community Version 5.0 локально: (через установщик `.msi`, и просто все оставляем по умолчанию)


```python
from IPython.display import display, Image
```


```python
for i in range(1, 10):
    print(f"Шаг {i}:")
    display(Image(url=f"{i}.png"))
```

    Шаг 1:
    


<img src="1.png"/>


    Шаг 2:
    


<img src="2.png"/>


    Шаг 3:
    


<img src="3.png"/>


    Шаг 4:
    


<img src="4.png"/>


    Шаг 5:
    


<img src="5.png"/>


    Шаг 6:
    


<img src="6.png"/>


    Шаг 7:
    


<img src="7.png"/>


    Шаг 8:
    


<img src="8.png"/>


    Шаг 9:
    


<img src="9.png"/>


Как можно увидеть, на последнем скрине, сервер монги не запустился из-за отсутствия директория `C:/data/db`. Просто создадим эту директорию и перезапустим сервер, заодно и запустим и консольку монги и убедимся что все работает корректно:


```python
display(Image(url="10.png"))
```


<img src="10.png"/>


- <h3>Шаг второй</h3>

Создадим базу данных `task1` и collection `sample`. И заимпортим туда данные `jobs.tsv` которые я скачал из кеггл. датасет содержит ифнормацию о вакансиях в различные периоды времени в США с описанием работы и требований, а так же с информацией о локации работы.


```python
for i in range(11, 16):
    print(f"Шаг {i}:")
    display(Image(url=f"{i}.png"))
```

    Шаг 11:
    


<img src="11.png"/>


    Шаг 12:
    


<img src="12.png"/>


    Шаг 13:
    


<img src="13.png"/>


    Шаг 14:
    


<img src="14.png"/>


    Шаг 15:
    


<img src="15.png"/>


- <h3>Шаг третий</h3>

Попробуем поискать все вакансии с `"JobId": "4"`:


```python
display(Image(url="16.png"))
```


<img src="16.png"/>


Посмотрим на детали запроса:


```python
display(Image(url="17.png"))
```


<img src="17.png"/>


Видим, что индекса под это поле нет в базе данных, поэтому при поиске рассматриваются все документы. Создадим индекс и еще раз посмотрим на детали запроса:


```python
for i in (18, 19):
    display(Image(url=f"{i}.png"))
```


<img src="18.png"/>



<img src="19.png"/>


Как видим, производительность очень значительно увеличилась, за счет индексации, и рассматривается только один документ, т.е. тот что имеет такое значение поля `JobID`.

Пробуем теперь поискать все вакансии в чьих полях `Description` или `Title` содержится слово "analyst". Заметим, что для поиска обязателен индекс типа `text` на соответствующих полях. Т.е. тут производительность не сравнить:


```python
for i in range(20, 24):
    display(Image(url=f"{i}.png"))
```


<img src="20.png"/>



<img src="21.png"/>



<img src="22.png"/>



<img src="23.png"/>


Замечаем, что каким-то чудом благодаря индексу, рассмотрелись только те документы которые подходят нашему запросу.

Теперь же, дропнем индекс у поля `Description` и попробуем поискать слово "Please" через регулярное выражение:


```python
display(Image(url="25.png"))
```


<img src="25.png"/>


Как видим, ситуация намного хуже когда нет индекса, т.е. паттерн регулярки ищется в каждом поле, что может отобрать колоссальное количество ресурсов и времени.

Напишем еще один запрос для разнообразия:


```python
display(Image(url="26.png"))
```


<img src="26.png"/>


Ожидали увидеть что не выйдет ни один документ под таким запросом, но для MongoDB `"200" < "3"` это `true`, поэтому видим все документы с `JobID` начинающиеся с цифры 2. Такое поведение обсоновано тем, что в датасете нет цифр и все является строкой. Сравним снова же производительности c индексом и без:


```python
for i in (27, 28):
    display(Image(url=f"{i}.png"))
```


<img src="27.png"/>



<img src="28.png"/>


- <h3>Шаг четвертый</h3>

Сменим имя профессии у которого `JobID` равен "23", и сравним производительность с индексом:


```python
for i in (29, 30):
    display(Image(url=f"{i}.png"))
```


<img src="29.png"/>



<img src="30.png"/>


Как видим, создание индекса тут помогло сократить количество рассматриваемых документов, но время исполнения слегка увеличилось.

Теперь попробуем удалить этот документ и сравним проивзодительности:


```python
for i in (31, 32):
    display(Image(url=f"{i}.png"))
```


<img src="31.png"/>



<img src="32.png"/>


Тут индекс уже существенно помогает удалить документ, т.к. производится поиск уже в `B-tree`вместо линейного поиска когда нет индекса.

__Conclusion:__ Таким образом, рассмотрели базовые операции СУБД MongoDB, а так же поняли что в большинстве случаев индексация полей улучшает проивзодительность.


```python

```
